# 마일스톤: 2026-02-04

## 튜토리얼 UI 전면 개선

### 주요 변경사항

#### 1. 스포트라이트 코치마크 방식 도입
- 기존 큰 카드 방식에서 모바일 게임 스타일 튜토리얼로 변경
- SVG mask를 사용한 스포트라이트 효과 (어두운 오버레이에 구멍)
- 하이라이트된 요소만 밝게 보이는 UX

#### 2. 데스크톱/모바일 반응형 처리
- **데스크톱 (8단계)**: 홈 → 우리의 기록 → 커뮤니티 → AI 펫톡 → 펫 매거진 → 입양정보 → 지역정보 → 분실동물
- **모바일 (6단계)**: 홈 → 우리의 기록 → 커뮤니티 → AI 펫톡 → 펫 매거진 → 더보기
- 타겟 요소의 실제 화면 위치로 데스크톱/모바일 자동 판별

#### 3. 말풍선 위치 최적화
- 데스크톱: 헤더 아래에 말풍선, 화살표가 위로
- 모바일: 하단 네비 위에 말풍선, 화살표가 아래로
- 화면 경계 체크 후 화살표가 항상 타겟을 정확히 가리키도록 계산

#### 4. 디자인 개선
- 몽글몽글 구름 스타일 말풍선 본체
- 깔끔한 삼각형 화살표 (CSS border 사용)
- 파스텔 톤 반짝이 장식
- 진행 표시 동그란 원형으로 귀엽게

### 수정된 파일
- `src/components/features/onboarding/TutorialTour.tsx` - 튜토리얼 전면 재작성
- `src/components/common/Layout.tsx` - 모바일 메뉴에 data-tutorial-id 추가

---

## AI 펫톡 Supabase 동기화

### 변경사항
- 채팅 기록을 localStorage에서 Supabase로 변경
- 같은 계정으로 모바일/데스크톱에서 채팅 기록 공유 가능
- `ai_chats` 테이블 사용 (user_id, pet_id 기준 upsert)

### 수정된 파일
- `src/components/pages/AIChatPage.tsx` - Supabase 연동

---

## 기술적 해결 과제

1. **useEffect 무한 루프 방지**: `useRef`로 onNavigate 참조 관리
2. **TypeScript 타입 에러**: `forEach` → `Array.from().find()` 변환
3. **숨겨진 요소 필터링**: `getBoundingClientRect()`로 실제 보이는 요소만 탐지
4. **화살표 정확도**: 말풍선이 화면 가장자리로 밀려도 타겟 중심 가리키도록 `arrowLeft` 계산

---

## 다음 작업 예정
- [ ] 튜토리얼 실제 테스트 및 버그 수정
- [ ] AI 펫톡 채팅 동기화 테스트
- [ ] 이미지 최적화 (next/image 경고 해결)
