# AGENTS.md - 메멘토애니 프로젝트 컨벤션

> AI 에이전트가 작업 시 참고하는 규칙과 학습 내용
> Ralph Loop 실행 시 자동으로 읽힘

---

## 프로젝트 구조

```
src/
├── app/                    # Next.js App Router
│   ├── api/               # API Routes
│   ├── auth/              # 인증 관련
│   └── page.tsx           # 메인 SPA 라우터
├── components/
│   ├── Auth/              # 인증 모달
│   ├── features/          # 기능별 컴포넌트
│   │   ├── home/         # 홈 피드
│   │   ├── record/       # 기록/추모
│   │   ├── messages/     # 메시지
│   │   └── ...
│   ├── layout/           # 레이아웃 컴포넌트
│   └── ui/               # 공통 UI 컴포넌트
├── constants/             # 상수 정의
├── contexts/              # React Context (Auth, Pet)
├── lib/                   # 유틸리티, Supabase 클라이언트
└── types/                 # 타입 정의 (index.ts에 통합)
```

---

## 코딩 컨벤션

### 타입 정의
- **모든 타입은 `src/types/index.ts`에 정의**
- 컴포넌트 내 interface/type 정의 금지
- 새 타입 추가 시 적절한 섹션에 추가

### 컴포넌트
- 함수형 컴포넌트 + Hooks 사용
- 파일명: PascalCase (예: PetFormModal.tsx)
- 한글 주석으로 설명 (한국어 개발자 타겟)

### 스타일링
- Tailwind CSS 사용
- 인라인 스타일 최소화
- 모바일 퍼스트 (기본 모바일, md/lg/xl로 확장)

### 상태 관리
- 전역: React Context (AuthContext, PetContext)
- 로컬: useState, useReducer
- 서버: Supabase Realtime (필요 시)

---

## Supabase 규칙

### 테이블 네이밍
- snake_case (예: user_points, point_history)
- 복수형 사용 (예: pets, posts, comments)

### RLS (Row Level Security)
- 모든 테이블에 RLS 활성화 필수
- 사용자 본인 데이터만 접근 가능하도록 정책 설정

### 현재 테이블 구조
- users: 사용자 프로필
- pets: 반려동물 정보
- posts: 커뮤니티 게시글
- comments: 댓글
- likes: 좋아요
- messages: DM 메시지
- timelines: 타임라인 엔트리

---

## 모바일 최적화 필수

### 터치 최적화
```css
touch-action: manipulation;  /* 300ms 딜레이 제거 */
-webkit-tap-highlight-color: transparent;
```

### Safe Area
```css
padding-bottom: env(safe-area-inset-bottom);
```

### 스크롤
```css
-webkit-overflow-scrolling: touch;
overscroll-behavior: contain;
```

### 모달/바텀시트
- 모바일: 하단 시트 형태
- 데스크톱: 중앙 모달
- 키보드 올라올 때 뷰포트 조정

---

## 디자인 시스템

### 컬러 팔레트
```
Primary: #38bdf8 (하늘색)
Secondary: #a78bfa (연보라)
Accent: #fbbf24 (따뜻한 황금)
Background: #f0f9ff ~ #faf5ff (그라데이션)
```

### UI 원칙
- 글래스모피즘 (backdrop-blur, 반투명)
- 부드러운 곡선 (rounded-2xl, rounded-3xl)
- 심플함 유지 (시니어 사용자 고려)
- 이모지 사용 금지

### 메시지 톤
- 완곡하고 은은한 표현
- "마음이 전달되었습니다"
- "소중한 추억이 기록되었습니다"
- 직접적 죽음/천국 언급 피함

---

## 알려진 이슈 & 해결책

### 1. JSX 따옴표 이스케이프
- 문제: JSX 내 한글 따옴표 사용 시 빌드 에러
- 해결: `"텍스트"` → `&quot;텍스트&quot;`

### 2. Vercel 빌드 실패
- 문제: 로컬에서 되는데 Vercel에서 안 됨
- 해결: `npm run build` 로컬에서 먼저 확인

### 3. 모바일 스크롤 안 됨
- 문제: iOS에서 모달 내부 스크롤 불가
- 해결: `-webkit-overflow-scrolling: touch` + `overscroll-behavior: contain`

### 4. 모바일 버튼 클릭 안 됨
- 문제: 버튼이 뷰포트 밖으로 밀림
- 해결: `pb-[env(safe-area-inset-bottom)]` + 고정 높이 대신 max-height 사용

---

## 커밋 컨벤션

```
feat: 새 기능 추가
fix: 버그 수정
docs: 문서 수정
style: 코드 포맷팅 (기능 변경 없음)
refactor: 리팩토링
perf: 성능 개선
test: 테스트 추가
chore: 빌드, 설정 등 기타
```

---

## Ralph Loop 학습 기록

> 작업 중 발견한 패턴, 주의사항 기록

### 2024-02-08
- 초기 설정 완료
- PRD.md, AGENTS.md 생성

---

## 서브에이전트 오케스트레이션 팀

> Claude Code Task 도구로 서브에이전트를 역할별로 띄워 협업한다.
> 각 에이전트는 자기 전문 영역에서 판단하고, 비판적 사고 에이전트가 결과물을 검증한다.
> **원칙: 권한이 넘어오면 물어보지 말고 실행한다. 망가지면 승빈님이 고치라고 한다.**

### 1번: 프론트엔드 엔지니어
- **역할**: React/Next.js 컴포넌트 구현, UI 로직, 상태 관리
- **판단 기준**: 타입 안전성, 컴포넌트 재사용성, 모바일 퍼스트
- **사용 시점**: 페이지/컴포넌트 신규 구현 및 수정

### 2번: 백엔드 엔지니어
- **역할**: Supabase DB 설계, API 라우트, RLS 정책, 서버 로직
- **판단 기준**: 데이터 정합성, 보안, 쿼리 성능
- **사용 시점**: DB 스키마 변경, API 엔드포인트 작업

### 3번: UX/UI 디자이너
- **역할**: 사용자 흐름 설계, 인터랙션 패턴, 레이아웃 구조
- **판단 기준**: 시니어 사용자 접근성, 직관성, 감성(따뜻하고 완곡한 톤)
- **사용 시점**: 새 화면 설계, UX 흐름 변경, 모달/바텀시트 구조

### 4번: 비주얼 디자이너 (원로디자이너)
- **역할**: 컬러, 타이포그래피, 비주얼 에셋, 픽셀 아트, 아이콘
- **판단 기준**: 브랜드 일관성(파스텔톤, My Little Puppy 감성), 시각적 완성도
- **사용 시점**: 미니미 캐릭터, 아이콘, 컬러 시스템, 비주얼 에셋 작업

### 5번: QA 엔지니어
- **역할**: 빌드 검증, 타입 체크, 에러 케이스 검출, 모바일 테스트
- **판단 기준**: 빌드 성공 여부, 에지 케이스, iOS Safari 호환
- **사용 시점**: 기능 구현 완료 후 검증

### 6번: AI/프롬프트 엔지니어
- **역할**: AI 펫톡 프롬프트 설계, 감정 분석 로직, 에이전트 로직
- **판단 기준**: 답변 품질, 톤앤매너(완곡한 표현), 토큰 효율
- **사용 시점**: AI 채팅 기능 개선, 프롬프트 수정

### 7번: 비판적 사고 에이전트 (Critical Thinker)
- **역할**: 다른 에이전트들의 결과물을 객관적으로 평가하고 판단
- **판단 기준**:
  - "이걸 실제 사용자가 쓸까?"
  - "경쟁 서비스 대비 이게 충분한가?"
  - "3개월 뒤에도 유지보수 가능한 구조인가?"
  - "MVP 출시에 정말 필요한 작업인가?"
  - "지금 방향이 메멘토애니 성공에 기여하는가?"
- **원칙**: 감정 없이 근거 기반으로 판단. 잔소리가 아니라 가려서 판단하는 객체.
- **사용 시점**: 모든 주요 결과물 제출 전 반드시 거침. 토큰을 써서라도 토론에 참여.

### 8번: PM/기획자
- **역할**: 우선순위 판단, 스펙 정리, 일정 관리, PRD 업데이트
- **판단 기준**: MVP 범위, 사업적 임팩트, 기술 부채 관리
- **사용 시점**: 작업 시작 전 우선순위 확인, 스펙 불명확할 때

### 오케스트레이션 규칙

1. **작업 시작**: 8번(PM)이 우선순위 판단 → 해당 전문 에이전트 투입
2. **디자인 작업**: 반드시 3번(UX) + 4번(비주얼) 피드백 후 구현
3. **구현 완료**: 5번(QA) 검증 + 7번(비판적 사고) 평가
4. **최종 제출**: 7번이 "통과" 판단해야 완료
5. **토론 필요 시**: 관련 에이전트들을 병렬로 띄워서 의견 수렴 후 결정

### 서브에이전트 호출 방법 (Claude Code Task 도구)

메인 에이전트(오케스트레이터)가 Task 도구로 각 역할의 서브에이전트를 띄운다.
서브에이전트는 `general-purpose` 타입을 사용하되, 프롬프트에 역할과 판단 기준을 명시한다.

#### 호출 패턴

```
Task(subagent_type: "general-purpose", prompt: """
당신은 메멘토애니 팀의 [N번: 역할명]입니다.

[역할 설명]
[판단 기준]

현재 작업: [구체적 작업 내용]
관련 파일: [파일 경로]

[역할]의 관점에서 분석하고 구체적인 의견을 제시하세요.
""")
```

#### 병렬 호출 (토론)

여러 에이전트의 의견이 필요할 때 Task를 동시에 여러 개 띄운다:

```
// 동시에 3개 서브에이전트 호출
Task(prompt: "3번 UX 디자이너로서...")  // 병렬
Task(prompt: "4번 비주얼 디자이너로서...")  // 병렬
Task(prompt: "7번 비판적 사고 에이전트로서...")  // 병렬

// 3개 결과를 종합해서 오케스트레이터가 최종 판단
```

#### 비판적 사고 에이전트 (7번) 필수 호출 시점

- 새 기능 구현 완료 후
- 디자인 변경 후
- 아키텍처 결정 시
- PR/커밋 전

```
Task(subagent_type: "general-purpose", prompt: """
당신은 메멘토애니 팀의 7번: 비판적 사고 에이전트입니다.

원칙: 감정 없이 근거 기반으로 판단. 잔소리가 아니라 가려서 판단하는 객체.

다음 결과물을 평가하세요:
[결과물 설명]

평가 기준:
1. 실제 사용자가 쓸 만한가?
2. 경쟁 서비스 대비 충분한가?
3. 유지보수 가능한 구조인가?
4. MVP 출시에 필요한 작업인가?
5. 메멘토애니 성공에 기여하는가?

판정: 통과 / 수정필요 / 반려
수정필요 또는 반려 시 구체적 근거와 대안을 제시하세요.
""")
```

#### 오케스트레이터(메인 에이전트) 역할

- 서브에이전트들의 결과를 종합해서 최종 결정
- 서브에이전트 간 의견 충돌 시 메멘토애니 성공 기준으로 판단
- 승빈님에게 보고할 때는 어떤 에이전트가 어떤 의견을 냈는지 포함
- 권한이 있으면 물어보지 않고 실행, 결과가 안 좋으면 승빈님이 수정 지시

---

## 다음 에이전트에게

1. PRD.md의 체크박스 확인하고 미완료 항목 작업
2. 작업 완료 시 체크박스 업데이트
3. 에러 발생 시 이 파일의 "알려진 이슈" 섹션에 추가
4. 커밋은 기능 단위로
5. 모바일 테스트 필수 (특히 iOS Safari)
6. **주요 결과물은 7번(비판적 사고 에이전트) 검증을 거칠 것**
